var __webpack_modules__={943:(e,t,i)=>{i.d(t,{H:()=>p,g:()=>d});class r{render(e,t,i){let r=$("<div/>",{style:"border:1px solid gray; border-radius:3px; white-space:pre-wrap; padding:2px; flex:1 1"}).attr("contentEditable","plaintext-only").attr("tabIndex",-1).text(t);return r.get(0).oninput=_(e.key,i&&i.onchange),r}parse(e){return e.innerText}present(e,t){return $("<div/>").css("white-space","pre-wrap").text(null==t?"":t)}}class s{render(e,t,i){let r=document.createElement("input");return r.type="input",r.value=null==t?"":t,r.style.width="150px",r.oninput=_(e.key,i&&i.onchange),r}parse(e){let t=("INPUT"==e.tagName?e.value:e.innerText).trim();return t?parseFloat(t):void 0}present(e,t){return $("<span/>").text(null==t?"":t)}}class n{render(e,t,i){let r=document.createElement("select");for(let t of e.options){let e=document.createElement("option");e.text=t.key,e.value=n.getOptionValue(t),r.add(e)}return r.style.width="150px",r.value=t,r.onchange=_(e.key,i&&i.onchange),r}static getOptionValue(e){return e.hasOwnProperty("value")?e.value:e.key}parse(e,t){if("SELECT"==e.tagName){if(e.selectedIndex<0)return;for(let i of t.options){let t=n.getOptionValue(i);if(t==e.value)return t}return null}return e.value}present(e,t){let i=e.options.find((e=>n.getOptionValue(e)==t));return $("<span/>").text(i?i.key:"").prop("value",t)}}let a=[{key:"string"},{key:"text"},{key:"integer"},{key:"number"},{key:"float"},{key:"enum"},{key:"type"},{key:"boolean"},{key:"image"},{key:"object"},{key:"...#"}];class l{constructor(e){this.jelemCls=e}render(e,t,i){return createJelem(this.jelemCls,e,t,i)}parse(e,t){return getJelem(e,this.jelemCls).wrap().parse(t)}present(e,t,i){return createJelem(this.jelemCls,e,t,i)}getLabel(e,t){if(this.jelemCls.getLabel)return this.jelemCls.getLabel(e,t);{if(!t)return"";let i=e.fields.find((e=>e.asLabel)),r=t[i?i.key:e.fields[0].key];return void 0!==r?r:""}}}let o={};function p(e,t){t instanceof Function&&(t=new l(t)),o[e]=t}function d(e){return o[e]}function _(e,t){if(t)return function(i){t(e,i.target)}}p("string",new class{render(e,t,i){let r=document.createElement("input");return r.type="input",r.value=null==t?"":t,r.style.width="100%",e.placeholder&&(r.placeholder=e.placeholder),r.oninput=_(e.key,i&&i.onchange),r}parse(e){return"INPUT"==e.tagName?e.value:e.innerText}present(e,t){return $("<span/>").text(null==t?"":t)}}),p("text",new r),p("integer",new class{render(e,t,i){let r=document.createElement("input");return r.type="input",r.value=null==t?"":t,r.style.width="150px",r.oninput=_(e.key,i&&i.onchange),r}parse(e){let t=("INPUT"==e.tagName?e.value:e.innerText).trim();return t?parseInt(t):void 0}present(e,t){return $("<span/>").text(null==t?"":t)}}),p("number",new s),p("float",new s),p("enum",new n),p("type",new class{render(e,t,i){let r=document.createElement("select");for(let e of a){let t=document.createElement("option");t.text=e.key,t.value=e.value||e.key,r.add(t)}return r.style.width="150px",r.value=t,r.onchange=_(e.key,i&&i.onchange),r}parse(e,t){if("SELECT"==e.tagName){if(e.selectedIndex<0)return;for(let t of a)if((t.value||t.key)==e.value)return t.value||t.key;return null}return e.value}present(e,t){let i=a.find((e=>(e.value||e.key)==t));return $("<span/>").text(i?i.key:"").prop("value",t)}}),p("boolean",new class{render(e,t,i){let r=document.createElement("input");return r.type="checkbox",r.checked=t,r.onchange=_(e.key,i&&i.onchange),r}parse(e){return e.checked}present(e,t){let i=document.createElement("input");return i.type="checkbox",i.checked=t,i.disabled=!0,i}}),p("code",new class{render(e,t){let i=document.createElement("div");return i.style.whiteSpace="pre",i.style.fontFamily="Courier New,serif",i.style.border="1px solid gray",i.style.padding="5px",i.contentEditable=!0,i.innerText=t,i}parse(e){return e.innerText}present(e,t){return $("<span/>").text(t).css("white-space","pre")}}),p("json",new class extends r{compile(e){return JSON.parse(e)}})},262:(e,t,i)=>{i.d(t,{J:()=>a}),i(941);var r=i(183),s=i(574),n=(i(173),i(269));class a{constructor(e,t,i){this.mbase(e,t,i),Object.assign(this.__MD,{_id:t&&t._id||crypto.randomUUID(),_type:t&&t._type,__pos:t&&t.__pos,status:0,data:{}});for(let i of e.fields)if(Object.defineProperty(this,i.key,this.getPropertyDescriptor(i.key)),t&&(t.hasOwnProperty(i.key)||i.array||(0,n.Kn)(i.type))){let e=this.__MD.options?.patchable;this.__MD.data[i.key]=(0,s.tP)(i,t[i.key],Object.assign({parent:this},e&&{patchable:e}))}Object.defineProperty(this,"_id",{get:()=>this.__MD._id,enumerable:!0}),Object.defineProperty(this,"_type",{get:()=>this.__MD._type,enumerable:!0}),Object.defineProperty(this,"__pos",{get:()=>this.__MD.__pos,set:e=>this.__MD.__pos=e,enumerable:!0})}destruct(){this.__MD.listeners.destruct();for(let e in this.__MD.data)(0,s.l)(this.__MD.data[e]);delete this.__MD.options.parent}async _cancel(){let e=this.getOriginalData();e?._id?(await this.update(e),this.setStorageStatus(0)):this.getParent().remove(this)}async _delete(){for(let e=this.getParent();null!=e;e=e.getParent())if(e instanceof a&&e.__MD.status)return;await this.patch([{jpath:this.getJPath(),old:this.getOriginalData(),new:null}])}_remove(e){for(let t in this.__MD.data)if(this.__MD.data[t]==e)return delete this.__MD.data[t],e}getPropertyDescriptor(e){return{set:t=>this.setProperty(e,t),get:()=>this.getProperty(e),enumerable:!0}}async setProperty(e,t){let i=this.__MD.data[e];i instanceof a||i instanceof r.X?await i.update(t):i!==t&&(this.__MD.data[e]=t,this.setStorageStatus(1),this.publish({type:"fieldChange",key:e,value:t}))}getProperty(e){return this.__MD.data[e]}async update(e){for(let t of this.__MD.meta.fields)await this.setProperty(t.key,e&&e[t.key]);if(e&&void 0!==e.__pos&&e.__pos!=this.__pos){this.__pos=e.__pos;let t=this.getParent();t&&t instanceof r.X&&t.reorder()}return this}remove(e){}getId(){return this.__MD._id}getEditable(){return this.__MD.options.storage||this.__MD.options.patchable}async delete(){let e=this.getParent();e?await e.remove(this):await(0,s.$s)(this)}}Object.assign(a.prototype,s.UI)},183:(e,t,i)=>{i.d(t,{X:()=>n});var r=i(262),s=i(574);class n extends Array{constructor(e,t,i){if(super(),this.mbase(e,t,i),Object.assign(this.__MD,{entityMeta:{...e,array:!1}}),t&&t.length)for(let e of t)super.push(this._makeEntity(e));this.order()}getEntityMeta(){return this.__MD.entityMeta}destruct(){this.__MD.listeners.destruct();for(let e=0;e<this.length;e++)(0,s.l)(this[e]);delete this.__MD.options.parent}_delete(){}order(){if(this.__MD.entityMeta.fields&&this.__MD.entityMeta.fields.length>0||this.__MD.entityMeta.types){this.sort(((e,t)=>void 0!==e.__pos?void 0!==t.__pos?e.__pos-t.__pos:-1:void 0!==t.__pos?1:0));let e=0;for(let t of this)void 0!==t.__pos?e=t.__pos:(e+=1024,t.__pos=e)}}reorder(){if(this.__MD.entityMeta.fields&&this.__MD.entityMeta.fields.length>0||this.__MD.entityMeta.types){let e=!1,t=0;for(let i of this){let r=i.__pos||1/0;if(r<t){e=!0;break}t=r}e&&(this.order(),this.publish({type:"change"}))}}_insertEntity(e,t){return void 0===t&&void 0!==e.__pos||(t=void 0!==t?t:this.length-1,e instanceof r.J&&(t<=0?e.__pos=this.length>0?this[0].__pos/2:1024:t>=this.length?e.__pos=this.length>0?this[this.length-1].__pos+1024:1024:e.__pos=(this[t-1].__pos+this[t].__pos)/2)),super.splice(t,0,e),e instanceof r.J?e.setStorageStatus(1):this.setStorageStatus(1),e}_popEntity(e){let t=this[e];return super.splice(e,1),t instanceof r.J?t.setStorageStatus(1):this.setStorageStatus(1),t}_makeEntity(e){let t=this.__MD.options?.patchable;return(0,s.tP)(this.__MD.entityMeta,e,Object.assign({parent:this},t&&{patchable:t}))}_normalizeRoundIndex(e,t){return void 0===e&&(e=-1),e<0&&(e+=t),e<0?0:e>=t?t-1:e}push(e,t){let i=this._insertEntity(this._makeEntity(e),this._normalizeRoundIndex(t,this.length+1));return this.publish({type:"change"}),i}move(e,t){e<0||e>this.length-1||t<0||t>this.length-1||e==t||(this._insertEntity(this._popEntity(e),t),this.publish({type:"change"}))}async pop(e){let t=await(0,s.$s)(this._popEntity(this._normalizeRoundIndex(e,this.length)));return this.publish({type:"change"}),t}_updateAsValue(e){let t,i=!1;for(t=0;t<e.length;t++){let r=e[t];this[t]!==r&&(i=!0,super.splice(t,0,r))}for(;this.length>t;)super.pop(),i=!0;return i}async _updateAsEntity(e){let t=!1,i=[];for(let r=0;r<e.length;r++){let s=e[r],n=this.find((e=>e.getId()==s._id));n?(s.__pos&&s.__pos!=n.__pos&&(t=!0),await n.update(s)):i.push(r)}if(this.length+i.length>e.length)for(let i=this.length-1;i>=0;i--){let r=this[i];e.find((e=>e._id==r._id))||(this.splice(i,1),await(0,s.$s)(r),t=!0)}if(i.length>0){for(let t of i){let i=this._makeEntity(e[t]);this._insertEntity(i,i.__pos?void 0:t)}this.order(),t=!0}return t}async update(e){void 0===e&&(e=[]),(this.__MD.entityMeta.types||this.__MD.entityMeta.fields&&this.__MD.entityMeta.fields.length>0?await this._updateAsEntity(e):this._updateAsValue(e))&&this.publish({type:"change"})}async remove(e){for(let t=0;t<this.length;t++)if(this[t]===e)return await(0,s.$s)(this._popEntity(t)),this.publish({type:"change"}),e}}Object.assign(n.prototype,s.UI)},574:(e,t,i)=>{i.d(t,{UI:()=>p,$s:()=>u,l:()=>h,kK:()=>g,u7:()=>d,tP:()=>c,Uc:()=>x,B6:()=>b,jl:()=>w});var r=i(262),s=i(183);class n{constructor(){this.listeners=[],this.namedListeners={}}destruct(){for(;this.listeners.length>0;)this.listeners.pop();for(let e in this.namedListeners)delete this.namedListeners[e]}add(e,t){e instanceof Function?this.listeners.push(e):this.namedListeners[e]=t}remove(e){if(e instanceof Function){let t=this.listeners.findIndex((t=>t==e));if(t<0)return;t>0&&(this.listeners[t]=this.listeners[0]),this.listeners.shift()}else delete this.namedListeners[e]}publish(e){for(let t of this.listeners)try{t(e)}catch(e){console.error(e)}for(let t in this.namedListeners)try{this.namedListeners[t](e)}catch(e){console.error(e)}}}var a=i(941),l=i(269),o=i(173);const p={mbase:function(e,t,i){i?.storage&&(i={...i,patchable:!0}),this.__MD={meta:e,options:i||{},listeners:new n},i?.storage&&(this.__MD.originDataNormalized=(0,o.w)(t),this.__MD.originData=(0,o.F)(t)),Object.defineProperty(this,"__MD",{writable:!0,enumerable:!1})},getMeta:function(){return this.__MD.meta},getParent:function(){return this.__MD.options&&this.__MD.options.parent},getRoot:function(){for(let e=this;null!=e;){let t=e.getParent();if(!t)return e;e=t}},getJPath:function(){let e=[];for(let t=this;null!=t;t=t.getParent()){let i=t.getParent();if(!i)break;i instanceof s.X?e.unshift("#"+t.getId()):e.unshift(t.__MD.meta.key)}return e.join(".")},getListener:function(){return this.__MD.listeners},getStore:function(){for(let e=this;null!=e;e=e.getParent())if(e instanceof r.J&&e.__MD.options.storage)return e},getOld:function(){let e,t=[];for(e=this;null!=e&&!e.__MD.options.storage;e=e.getParent()){let i=e.getParent();i&&i instanceof s.X?t.unshift("#"+e.getId()):t.unshift(e.__MD.meta.key)}let i=e.__MD.originData;for(let e of t){if(!i)break;if(e.startsWith("#")){let t=e.substring(1);i=i.find((e=>e._id==t))}else i=i[e]}return{jpath:t.join("."),old:i}},getOriginalData:function(){let e,t=[];for(e=this;null!=e&&!e.__MD.options.storage;e=e.getParent()){let i=e.getParent();i&&i instanceof s.X?t.unshift("#"+e.getId()):t.unshift(e.__MD.meta.key)}let i=e.__MD.originData;for(let e of t){if(!i)return;if(e.startsWith("#")){let t=e.substring(1);i=i.find((e=>e._id==t))}else i=i[e]}return i},setStorageStatus:function(e){if(e){let t;for(let i=this;null!=i;i=i.getParent())if(i instanceof r.J){if(i.__MD.status==e)return this;t||(t=i)}w(t,(e=>{e.__MD.status&&(e.__MD.status=0,e.publish({type:"storageChange",status:0}))})),t.__MD.status=e,t.publish({type:"storageChange",status:e})}else this.__MD.status&&(this.__MD.status=e,this.publish({type:"storageChange",status:e}));return this},getStorageStatus:function(){return this.__MD.status},publish:function(e){let t=this.getJPath();this.__MD.listeners.publish(e);let i=t.length-1;for(let r=this.getParent();null!=r;r=r.getParent()){let s=t.lastIndexOf(".",i);i=s-1;let n={type:"childEvent",jpath:s>=0?t.substring(s+1):t,event:e};r.__MD.listeners.publish(n)}return this},debug:function(){console.log("\\\\ entity \\\\");for(let e in this)console.log(`${e} = ${this[e]}`);console.log("////")},cancel:async function(){let e=[];w(this,(async t=>{1==t.getStorageStatus()&&e.push(t)}));for(let t of e)await t._cancel()},save:async function(){let e=[];w(this,(t=>{1==t.getStorageStatus()&&e.push({...t.getOld(),new:t})})),await this.patch(e);for(let t of e)t.new.setStorageStatus(0)},patch:async function(e){let t=this.getRoot(),i=t.__MD.options?.storage,r=t.__MD.options?.eid;t.__MD.originDataNormalized||(r?await(0,a.i8)(i,r,t.__MD.originData):await(0,a.A$)(i,t.__MD.originData),t.__MD.originDataNormalized=!0),r&&e.forEach((e=>e.jpath="#"+r+(e.jpath?"."+e.jpath:"")));let s=await(0,a.hk)(i,e);for(let e of s){let i=e.jpath;if(r){let e=i.indexOf(".");i=e>=0?i.substring(e+1):""}b(t.__MD.originData,i,e.old,e.new),await b(t,i,e.old,e.new)}}};async function d(e,t,i,r){let s=i?await(0,a.Hv)(e,i):await(0,a.VN)(e);if(!t&&!(t=await(0,a.wX)(e)))throw new Error("Invalid Meta");return await _(t),!t.array&&s instanceof Array&&(s=s[0]),s&&r&&(s=s instanceof Array?s.map((e=>r(e))):r(s)),c(t,s,{storage:e,eid:i})}async function _(e){if(e.types)for(let t of e.types)await _(t);else e.typeId&&e.typeId.startsWith("#")&&await(0,l.KW)(e.typeId),e.type&&e.type.startsWith("#")&&await(0,l.KW)(e.type);if(e.fields){for(let t of e.fields)await _(t);e.fields.sort(((e,t)=>void 0!==e.__pos?void 0!==t.__pos?e.__pos-t.__pos:-1:void 0!==t.__pos?1:0))}}function c(e,t,i){if((e=function(e){return(e=Object.assign({},e)).types?e.types=e.types.map((e=>f({...e}))):f(e),y(e)}(e)).array)return void 0===t&&(t=[]),t instanceof s.X?t:new s.X(e,t,i);if(e.types){let s=t._type,n=e.types.find((e=>e.typeId==s));return new r.J(n,t,i)}return e.fields&&e.fields.length>0?(void 0===t&&(t={}),t instanceof r.J?t:new r.J(e,t,i)):t}function h(e){e&&(e instanceof r.J||e instanceof s.X)&&e.destruct()}async function u(e){if(e)return(e instanceof r.J||e instanceof s.X)&&await e._delete(),h(e),e}function g(e){return null==e}function f(e){if(e.type.startsWith("#")){let t=(0,l.oL)(e.type);e.fields=t.fields,e.labelExpr=t.labelExpr,e.typeId=e.type,e.type="object",t.render&&(e.render=Object.assign({},t.render,e.render))}return e}function y(e){if("object"===e.type){let t=e.render?.ignorable;g(t)||(e.fields=e.fields.map((e=>y(g(e.render?.ignorable)?{...e,render:{...e.render,ignorable:t}}:e))))}else if(delete e.fields,e.types){let t=e.render?.ignorable;g(t)||(e.types=e.types.map((e=>y(g(e.render?.ignorable)?{...e,render:{...e.render,ignorable:t}}:e))))}return"enum"!==e.type&&delete e.options,e}function w(e,t){if(e instanceof s.X)for(let i of e)w(i,t);else if(e instanceof r.J){t(e);for(let i in e)w(e[i],t)}}async function b(e,t,i,n){let a=t.split("."),l=e;for(let e=0;e<a.length-1;e++){let t=a[e];if(t.startsWith("#")){let e=t.substring(1),i=l.find((t=>t._id==e));i||(l.push({_id:e}),i=l[l.length-1]),l=i}else{let i=l[t];if(!i){let r=a[e+1];l[t]=r.startsWith("#")?[]:{},i=l[t]}l=i}}let o=a.pop();if(o.startsWith("#")){let e=o.substring(1),t=l.findIndex((t=>t._id==e));l instanceof s.X?n?t>=0?await l[t].update(n):l.push(n):t>=0&&l.pop(t):n?t>=0?l[t]=n:l.push(n):t>=0&&l.splice(t,1)}else if(o)l[o]=n;else if(l instanceof r.J||l instanceof s.X)await l.update(n);else if(l instanceof Array){for(;l.length>0;)l.pop();n.forEach((e=>l.push(e)))}else{for(let e in l)delete l[e];for(let e in n)l[e]=n[e]}}function x(e){if(e instanceof Object){if(e instanceof Array){let t=[];for(let i of e)t.push(x(i));return t}{let t={};for(let i in e)"_id"!=i&&"__pos"!=i&&(t[i]=x(e[i]));return t}}return e}},269:(e,t,i)=>{i.d(t,{Fn:()=>a,KW:()=>n,Kn:()=>l,oL:()=>s});let r={};function s(e){return r[e]}async function n(e){r[e]}function a(e,t){r[e]=t}function l(e){return e.startsWith("#")&&(e=r[e].type),"object"==e}a("#meta",{type:"object",fields:[{key:"key",type:"string"},{key:"description",type:"string"},{key:"type",type:"type"},{key:"array",type:"boolean"},{key:"fields",type:"#meta",array:!0,cond:{type:"object"}},{key:"options",type:"object",array:!0,cond:{type:"enum"},fields:[{key:"key",type:"string"},{key:"value",type:"string"}]}]})},173:(e,t,i)=>{i.d(t,{F:()=>a,w:()=>n});var r=i(262),s=i(183);function n(e){if(e instanceof Object&&!(e instanceof r.J||e instanceof s.X))if(e instanceof Array){for(let t of e)if(!n(t))return!1}else{if(!e._id)return!1;for(let t in e)if(!n(e[t]))return!1}return!0}function a(e){if(e instanceof Object&&!(e instanceof r.J||e instanceof s.X))if(e instanceof Array)for(let t of e)a(t);else{for(let t in e)a(e[t]);e._id||(e._id=crypto.randomUUID())}return e}},941:(e,t,i)=>{i.d(t,{A$:()=>n,Ce:()=>p,Hv:()=>a,Ks:()=>o,VN:()=>s,eJ:()=>h,hk:()=>d,i8:()=>l,wX:()=>_});var r=i(173);async function s(e){let t=u(e);if(t)return await t.storage.getAllEntities(t.args)}async function n(e,t){let i=u(e);if(i)return await i.storage.setAllEntities(i.args,t)}async function a(e,t){let i=u(e);if(i)return await i.storage.getEntity(i.args,t)}async function l(e,t,i){let s=u(e);if(s)return await s.storage.updateEntity(s.args,t,(0,r.F)(i))}async function o(e,t){let i=u(e);if(i)return await i.storage.deleteEntity(i.args,t)}async function p(e,t){let i=u(e);if(i)return await i.storage.addEntity(i.args,(0,r.F)(t))}async function d(e,t){let i=u(e);if(i)return await i.storage.patchAllEntities(i.args,t)}async function _(e){let t=u(e);if(t&&t.storage.getMeta)return await t.storage.getMeta(t.args)}let c=[];function h(e,t){c.push({match:new g(e),storage:t})}function u(e){for(let t of c){let i=t.match.parse(e);if(i)return{args:i,storage:t.storage}}}class g{constructor(e){this.pattern=e,this.parts=[];let t,i=/\/:[a-zA-Z0-9_]+/g,r=0;for(;null!=(t=i.exec(e));){let s=t.index,n=i.lastIndex;this.addTextPattern(r,s+1),this.parts.push({type:"arg",key:e.substring(s+2,n)}),r=n}this.addTextPattern(r,e.length)}addTextPattern(e,t){t>e&&this.parts.push({type:"text",text:this.pattern.substring(e,t)})}parse(e){let t={},i=0;for(let r of this.parts)if("text"==r.type){if(!e.startsWith(r.text,i))return;i+=r.text.length}else if("arg"==r.type){let s=e.indexOf("/",i);s=s>0?s:e.length;let n=e.substring(i,s);if(!n)return;t[r.key]=n,i=s}let r=e.substr(i);if(!r||"/"==r)return t[0]=e,t}}},250:(e,t,i)=>{i.d(t,{o:()=>s});class r{constructor(e,t){this.items=e.map(((e,i)=>({model:e,jelem:$(t[i])})))}popByValue(e){let t=this.items.findIndex((t=>t.model===e));if(t>=0){let e=this.items[t];return this.items.splice(t,1),e}}getHead(){return this.items[0]}remove(){for(let e of this.items)e.jelem.remove()}}function s(e,t,i,s){let n=e.children().toArray().map((e=>$(e))),a=new r(n.map((e=>i(e))),n);for(let i of t){let t=a.getHead(),r=a.popByValue(i);if(r)r!==t&&r.jelem.insertBefore(t.jelem);else{let r=s(i);t?r.insertBefore(t.jelem):r.appendTo(e)}}a.remove()}},488:(e,t,i)=>{i.r(t),i.d(t,{BUTTON_H2:()=>r,BUTTON_H2H:()=>s,DOTS_MENU:()=>n,ENTITY_COLLAPSE:()=>a,ENTITY_EXPAND:()=>l});const r=createClass("font-size: 14px;\nfont-weight: bold;\nborder: none;\nborder-radius: 3px;\npadding: 4px 10px 4px 10px;\nmargin-right: 5px;\ncursor: hand;"),s=createClass("background-color: #0052CC;\ncolor: white;\nfont-size: 14px;\nfont-weight: bold;\nborder: none;\nborder-radius: 3px;\npadding: 4px 10px 4px 10px;\nmargin-right: 5px;\ncursor: hand;"),n=createClass("\nbackground-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAALNJREFUOE/FkiEOQjEMhtvdAcUh2t4AzgEWg0XADQgCi0JyD57ErT0AEvUuQDAlSx4Jgi0ZS6Cmou3f9duPUAgiGocQHjHGPteGuQIRzRHxAAB3RNzFGPeferMCzHwGgMkw1KnqtEqg+QVpWxODEtz3WolBun+GiFd3v6hqV8VARDbuvh2Gjqq6+K0AM7ed0AwxCYjIKOWvrCwiK3dfJ4G/WxncfWlmp6pvfFk5ZTO75aA+AaXmWhEjDJDPAAAAAElFTkSuQmCC);\ncursor: hand;\nwidth: 16px;\nheight: 16px;"),a=createClass("\nmargin-right:auto;\nbackground:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAALdJREFUOE/Nk+ENgjAQhe8YR91BnKBtYpzCHcQdnMKYXDuBuIM4Do+UCEEsQtM/9m+vX++9e8eUeDjxPbUArXXBzFsiyhcASwAPa23ha1uAMeYJ4GitLecAWuucmS8ishkCICJfcpRSK+fcaww1xvT1XQdBgO+s+2kIiQFMgRd3EAfwmrMsuxLROmBmVdf1wXvyxxIC40qbQkwO7gDOEUk8iciuT+J7F/YT7o+VVQBuH7swl/9f9w29apsRck7yYAAAAABJRU5ErkJggg==) no-repeat 2px;\npadding-left: 20px;\ncursor: hand;\npadding-right: 10px;"),l=createClass("\nmargin-right:auto;\nbackground:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAJlJREFUOE/dk9EJwmAMhC8gLqM7WDdIwDHcwbqDYwiXDaw76DIinFi0KFT6S9+a11w+kuNiGFk2ch4twN1rM1sBqAqAjaRzZtZPbQuIiIukbWY2QwB3r8zsQHL5CRDJ4nMiotO/N5gQwCLiBmDWY+ad5ByAJu7BUI7afp8HJ0n7P5K4I7nukvj6hQ2ARcEKV0nHr18oGPopeQBKBHgR4L5yxAAAAABJRU5ErkJggg==) no-repeat 2px;\npadding-left: 20px;\ncursor: hand;\npadding-right: 10px;")},397:(e,t,i)=>{i.d(t,{G:()=>d});var r=i(262),s=i(183),n=i(892),a=i(488),l=i(574),o=i(752);class p{constructor(e,t){this.jelem=e,this.index,this.updateLayout(),this.originIndex=this.index,this.offsetY=this.layouts[this.index].y-t.pageY}updateLayout(){let e=[];for(let t of this.jelem.siblings())e.push(this.getLayoutOfElement(t));let t=this.getLayoutOfElement(this.jelem.get(0));e.push(t),e.sort(((e,t)=>e.y-t.y)),this.layouts=e,this.index=this.layouts.findIndex((e=>e.y==t.y))}getLayoutOfElement(e){let t=e.getBoundingClientRect();return{x:t.x,y:t.y,w:t.width,h:t.height}}handleEvent(e){let t,i=e.pageY+this.offsetY;for(t=0;t<this.layouts.length;t++){let e=this.layouts[t];if(i<e.y+e.h/2)break}if(t==this.index||t==this.index+1)return;let r=this.jelem.parent().get(0);t>=this.layouts.length?r.appendChild(this.jelem.get(0),this.jelem.siblings(this.layouts.length).get(0)):r.insertBefore(this.jelem.get(0),r.children[t]),this.updateLayout()}handleEnd(e){this.originIndex!=this.index&&this.jelem.wrap().handleEntityMove(this.originIndex,this.index)}}class d{create(e,t,i){let s=i;i={...i},0!=e.getStorageStatus()&&(i.write=!0);let l=i.write||i.writable,_=$("<div/>").attr("id",e&&e._id).prop("entity",e instanceof r.J&&e).prop("options",s).append($("<div/>").append((l||i.code||navigator.clipboard)&&$("<div/>",{class:a.DOTS_MENU,style:"float:right;"}).click((e=>getJelem(e.target,d).wrap().showMenu()))).append(e.getEditable()&&l&&$("<button/>",{class:a.BUTTON_H2}).text("Cancel").click((()=>getJelem(event.target,d).wrap().cancel()))).append(e.getEditable()&&l&&$("<button/>",{class:a.BUTTON_H2H}).text("Save").click((()=>getJelem(event.target,d).wrap().save()))).append((0,o.z)($("<span/>",{class:a.ENTITY_EXPAND}),(0,n.vD)(e.getMeta(),e),t?.render?.icon).click((e=>getJelem(e.target,d).wrap().switchCollapse(null,e.shiftKey)))).attr("draggable",l).on("pointerdown",l&&(e=>{(0,n.v5)(e.pointerId)})).on("dragstart",l&&(e=>{let t=getJelem(e.target,d);(0,n.CA)(t,e,new p(t,e))})).on("dblclick",l&&(e=>{"DIV"==e.target.tagName&&getJelem(e.target,d).wrap().switchEdit()}))).append($("<div/>").append());return e instanceof r.J&&e.getListener().add("eControl",(e=>_.wrap().handleEntityEvent(e))),_.prop("edit",i.write),_.wrap(d).render(),_}css(){return{"":"margin:5px; \n            padding:5px; \n            border-radius:5px; \n            font-size:14px; \n            word-break: break-all;\n            box-shadow: 0px 2px 5px 0px rgba(9,30,66,0.12)",">div:first-child":"background-color:#DDDDDD; height:25px; padding:2px; display:flex; align-items:center; flex-direction: row-reverse",".editable":"border: 1px solid gray; border-radius: 3px; padding: 3px"}}wrap(){return class{showMenu(){let e=this.children(":first-child").children(":first-child").get(0).getBoundingClientRect(),t=this,i=this.prop("options")||{},r=this.prop("entity"),a=i.write||i.writable,l=$("<div/>").append(a&&createJelem(n.sN,null,"Edit",(()=>t.wrap().edit()))).append(a&&r.getParent()instanceof s.X&&createJelem(n.sN,null,"Duplicate",(()=>t.wrap().duplicate()))).append(navigator.clipboard&&createJelem(n.sN,null,"Copy",(()=>t.wrap().copy()))).append(navigator.clipboard&&createJelem(n.sN,null,"Paste",(()=>t.wrap().paste()))).append(i.code&&createJelem(n.sN,null,(this.prop("code")?"Hide":"Show")+" Code",(()=>t.wrap().switchCode()))).append(a&&r.getParent()instanceof s.X&&createJelem(n.sN,null,"Delete",(()=>t.wrap().delete())));l.children().length>0&&(0,n.U)(l,100,null,e.x+e.width-100,e.y+e.height,this)}async handleEntityMove(e,t){let i=this.prop("entity");i&&(parent=i.getParent(),parent&&parent instanceof s.X&&parent.move(e,t))}async edit(){this.prop("entity").setStorageStatus(1)}async save(){await this.prop("entity").save()}async switchEdit(){this.prop("edit")?await this.save():await this.edit()}async switchCode(){this.prop("code",!this.prop("code")),this.render()}async duplicate(){let e=this.get(0).getBoundingClientRect(),t=this.prop("entity");t.getParent().push((0,l.Uc)(t));let i=this.parent().children(":last-child").get(0).getBoundingClientRect(),r=(0,o.G)(this.get(0));r&&r.scrollBy(0,i.y-e.y)}async copy(){navigator.clipboard.writeText(JSON.stringify(this.prop("entity")))}async paste(){try{let e=JSON.parse(await navigator.clipboard.readText());this.prop("entity").setStorageStatus(1).update((0,l.Uc)(e))}catch(e){}}async delete(){await this.prop("entity").delete()}async cancel(){await this.prop("entity").cancel()}handleEntityEvent(e){if("storageChange"==e.type){let e=0!=this.prop("entity").getStorageStatus();e!=this.prop("edit")&&(this.prop("edit",e),this.render())}else"focus"==e.type&&this.get(0).scrollIntoView(!0)}needsHead(){let e=this.prop("options")||{},t=this.prop("entity"),i=e.write||e.writable;return t.getParent()instanceof s.X||t.getEditable()&&i||e.code}render(){let e=this.prop("entity"),t=e.getMeta(),i=this.prop("options")||{};this.children(":first-child").css("display",this.needsHead()?"":"none"),this.children(":first-child").find("button").css("display",this.prop("edit")&&e.getStorageStatus()?"inline-block":"none"),(0,o.z)(this.children(":first-child").children(":last-child"),(0,n.vD)(t,e),t?.render?.icon),this.prop("edit")&&this.switchCollapse(!1,!1),this.getEntityContainerJelem().html("").append(this.prop("code")?$("<div/>",{style:"white-space: pre-wrap"}).attr("contentEditable",!!this.prop("edit")&&"plaintext-only").attr("tabIndex",-1).attr("class",this.prop("edit")?"editable":null).append(JSON.stringify(e,null,"    ")):(0,n.uc)(t,e,{write:this.prop("edit"),writable:i.writable}))}getEntityContainerJelem(){return this.children(":first-child").next()}parse(){let e=this.prop("entity"),t=this.getEntityContainerJelem().children(":last-child");return this.prop("code")?JSON.parse(t.text()):(0,n.V9)(e.getMeta(),t.get(0))}switchCollapse(e,t){let i=this.getEntityContainerJelem(),r="none"==i.css("display");if(r!=(e=(0,l.kK)(e)?!r:e)&&(i.css("display",e?"none":""),this.children(":first-child").children("span").attr("class",e?a.ENTITY_COLLAPSE:a.ENTITY_EXPAND)),t){let t=this.siblings();for(let i=0;i<t.length;i++)$(t[i]).wrap().switchCollapse(e,!1)}}}}}},16:(e,t,i)=>{i.d(t,{B:()=>d});var r=i(892),s=i(183),n=i(250),a=i(574),l=i(488);class o{constructor(e,t,i){this.jelem=e,this.clicker=i,this.index,this.updateLayout(),this.originIndex=this.index,this.offsetY=this.layouts[this.index].y-t.pageY}updateLayout(){let e=[];for(let t of this.jelem.siblings())e.push(this.getLayoutOfElement(t));let t=this.getLayoutOfElement(this.jelem.get(0));e.push(t),e.sort(((e,t)=>e.y-t.y)),this.layouts=e,this.index=this.layouts.findIndex((e=>e.y==t.y))}getLayoutOfElement(e){let t=e.getBoundingClientRect();return{x:t.x,y:t.y,w:t.width,h:t.height}}handleEvent(e){let t,i=e.pageY+this.offsetY;for(t=0;t<this.layouts.length;t++){let e=this.layouts[t];if(i<e.y+e.h/2)break}if(t==this.index||t==this.index+1)return;let r=this.jelem.parent().get(0);t>=this.layouts.length?r.appendChild(this.jelem.get(0),this.jelem.siblings(this.layouts.length).get(0)):r.insertBefore(this.jelem.get(0),r.children[t]),this.updateLayout()}handleEnd(e){this.originIndex!=this.index&&getJelem(this.jelem,d).wrap().handleMEditChange()}}class p{create(){return $("<div/>").append($("<button/>",{style:""}).text("")).append($("<button/>").click((e=>{e.preventDefault(),e.stopPropagation(),getJelem(e.target,p).trigger("sideclick")})))}css(){return{"":"display:inline-block",button:"border: 1px solid gray; height: 25px; background-color: #EEEEEE; background-repeat: no-repeat; background-position: center;","button:hover":"background-color: #DDDDDD;",">:first-child":"width:100px;border-radius: 3px 0px 0px 3px;background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAZQTFRFAAAAUVFRd9XwPwAAAAJ0Uk5TAP9bkSK1AAAAFklEQVR4nGNggAHGBgSS/wFCyCIwAACSawY3SvR/WAAAAABJRU5ErkJggg==);",">:last-child":"width: 16px; margin-left: -1px; border-radius: 0px 3px 3px 0px;background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAGRJREFUOE9jZKAQMFKon2HUAAbUMAgODlb99+/fVgYGBlYcgfubiYnJe+3atbdh8hiBiGSIKpoht9E1g+SxxgIWQ7BqxmkASALJEAZsNuP0ArKzQYaA+Mh+Rg+b0YSEIxpJyaEA8LwnEYBFeiAAAAAASUVORK5CYII=);"}}}class d{create(e,t,i){let r=e.getEntityMeta(),n=i.write&&((e,t)=>{getJelem(t,d).wrap().handleMEditChange()});i=Object.assign({},i,{onchange:n});let a=$("<div />").prop("entity",e).prop("options",i).append($("<div/>").append((e||[]).map((e=>d.createEditableEntry(e,r,i))))).append(i&&(i.write||i.writable&&(r.fields||r.types))&&$("<div/>",{style:"padding: 5px"}).append(createJelem(p,{}).click((e=>getJelem(e.target,d).wrap().add())).on("sideclick",(e=>{getJelem(e.target,d).wrap().showPop()}))));return e instanceof s.X&&e.getListener().add("eList",(e=>a.wrap().handleEntityEvent(e))),a}static createEditableEntry(e,t,i){return t.fields&&t.fields.length||t.types?(0,r.fM)(e,t,i):$("<div/>",{style:"display:flex; margin-bottom: 2px"}).append((0,r.fM)(e,t,i)).append($(i&&i.write&&$("<div/>",{style:"flex:0 0 16px;",class:l.DOTS_MENU}).click((e=>{let t=e.target.getBoundingClientRect(),i=$(e.target).parent(),s=$("<div/>").append(createJelem(r.sN,null,"Delete",(()=>{let e=getJelem(i,d);i.remove(),e.wrap().handleMEditChange()})));(0,r.U)(s,100,null,t.x+t.width-100,t.y+t.height)})).attr("draggable",!0).on("pointerdown",(e=>{(0,r.v5)(e.pointerId)})).on("dragstart",(e=>{let t=$(e.target).parent();(0,r.CA)(t,e,new o(t,e,$(e.target)))}))))}wrap(){return class{add(){let e=this.children(":last-child").get(0),t=e.getBoundingClientRect().y,i=this.prop("entity");if(i){let e=i.getEntityMeta();e.types?(0,r._H)($("<div/>").append(e.types.map((e=>createJelem(r.sN,null,e.typeId.replace(/^#*/,""),(()=>i.push({_type:e.typeId})))))),this.children(":last-child").children(":last-child")):i.push()}else this.children(":first-child").append(d.createEditableEntry(void 0,this.prop("entity").getEntityMeta(),{write:!0}));let s=this.getScrollableElem(e);s&&s.scrollBy(0,e.getBoundingClientRect().y-t)}showPop(){(0,r._H)($("<div/>").append(createJelem(r.sN,null,"Copy",(()=>this.wrap().copy()))).append(createJelem(r.sN,null,"Paste",(()=>this.wrap().paste()))),this.children(":last-child").children(":last-child"))}copy(){navigator.clipboard.writeText(JSON.stringify(this.prop("entity")))}async paste(){try{let e=JSON.parse(await navigator.clipboard.readText());e=e instanceof Array?e:[e];let t=[];for(let i of e)t.push(this.prop("entity").push((0,a.Uc)(i)));t.length>0&&t[0].getListener().publish({type:"focus"})}catch(e){}}getScrollableElem(e){for(;e&&e!=document.body&&e.scrollHeight<=e.clientHeight;)e=e.parentNode;return e}remove(e){}handleEntityEvent(e){if("change"==e.type){let e=this.prop("entity"),t=e.getEntityMeta(),i=t.fields&&t.fields.length||t.types,s=this.prop("options");(0,n.o)(this.children(":first-child"),e,(e=>i?e.prop("entity"):(0,r.V9)(t,e.children()[0])),(e=>d.createEditableEntry(e,t,s)))}else"focus"==e.type&&this.get(0).scrollIntoView(!1)}handleMEditChange(){let e=this.prop("entity");e&&e.update(this.parse())}parse(){let e=[],t=this.prop("entity").getEntityMeta(),i=this.children(":first-child").children(),s=t.fields&&t.fields.length;for(let n=0;n<i.length;n++){let a=(0,r.wn)(s?$(i[n]).get(0):$(i[n]).children(":first-child").get(0),t);e.push(a)}return e}}}}},493:(e,t,i)=>{i.d(t,{X:()=>n});var r=i(892),s=i(262);class n{create(e,t,i){let l=document.createElement("table");l.style.width="100%",l.meta=e,n.getDynamicTriggers(e);let o=i.write&&((e,t)=>getJelem(t,n).wrap().onMeditChange(e,t));i=Object.assign({},i,{onchange:o}),l.options=i,t instanceof s.J&&(l.entity=t,t.getListener().add("oTable",(e=>$(l).wrap().onEntityChange(e))));let p=0;for(let t of e.fields){let e=(d=t.key,_="14px Arial",c=void 0,c=a.getContext("2d"),c.font=_,c.measureText(d)).width;p=Math.max(p,e)}var d,_,c;for(let s of e.fields){let n=s.key,a=t&&t[n],o=l.insertRow();o.fieldKey=n,e.render?.docStyle?$(o.insertCell()).css("padding-left","20px").append($("<div/>",{style:"font-style:italic; padding-top:3px; margin-left:-20px"}).text(n).attr("title",s.description)).append((0,r.fM)(a,s,i)):($(o.insertCell()).text(n).css("vertical-align","top").css("width",p+2+"px").attr("title",s.description),$(o.insertCell()).append((0,r.fM)(a,s,i)))}if(e.render?.compact&&i.write){let e=l.insertRow();$(e.insertCell()).attr("colspan",2).append($("<div/>",{style:"height: 12px; border-radius: 0px 0px 5px 5px; background: #DDDDDD url(../pics/arrow_white_down.png) no-repeat center; cursor:hand"}).click((e=>getJelem(e.target,n).wrap().switchCompact())))}return n.updateObjectDisplay(l,e,t,i),$(l)}static isFieldIgnorable(e,t){if(!1===e.render?.ignorable)return!1;if(e.array)return null==t||t.length<=0;if(t instanceof s.J){if(0!=t.getStorageStatus())return!1;for(let e of t.getMeta().fields)if(!n.isFieldIgnorable(e,t[e.key]))return!1;return!0}return"enum"==e.type?null==t||""===t:null==t||!1===t||""===t}static updateObjectDisplay(e,t,i,r){let s=e.rows;if(s.length<=0)return;let a=s[s.length-1].cells,l=1==a.length?a[0].childNodes[0]:null,o=l&&$(l).css("background-image").indexOf("up")<0;for(let e of s)if(e.fieldKey){let s=e.fieldKey,a=t.fields.find((e=>e.key==s)),l=!n.validateFieldCond(a,i)||(!r?.write||t.render?.compact&&o)&&t.render?.ignorable&&n.isFieldIgnorable(a,i[s])?"none":"";e.style.display!=l&&(e.style.display=l)}}static validateFieldCond(e,t){if(e&&e.cond)for(let i in e.cond)if(!t||t[i]!==e.cond[i])return!1;return!0}static getDynamicTriggers(e){let t={};for(let i in e.fields)if(e.fields[i].cond)for(let r in e.fields[i].cond)t[r]=1;return t}wrap(){return class{onMeditChange(e,t){let i=this.get(0),s=this.prop("meta"),a=this.prop("entity");n.updateObjectDisplay(i,s,this.parse(),this.prop("options")),a&&(a[e]=(0,r.wn)(t,s.fields.find((t=>t.key==e))))}findFieldRow(e){for(let t of this.get(0).rows)if(t.fieldKey==e)return t}onEntityChange(e){if("fieldChange"==e.type){let t=this.findFieldRow(e.key);if(t){let i=this.prop("meta").fields.find((t=>t.key==e.key));(0,r.wn)(t.cells[1].children[0],i)!==e.value&&($(t.cells[1]).html("").append((0,r.fM)(e.value,i,this.prop("options"))),n.updateObjectDisplay(this.get(0),this.prop("meta"),this.prop("entity"),this.prop("options")))}}else if("childEvent"==e.type){let t=e.jpath.indexOf(".");t>0?e.jpath.substring(0,t):e.jpath,n.updateObjectDisplay(this.get(0),this.prop("meta"),this.prop("entity"),this.prop("options"))}}parse(){let e=this.prop("meta"),t=this.get(0),i={};for(let s of t.rows)if(s.fieldKey){let t=s.fieldKey,n=e.fields.find((e=>e.key==t));i[t]=(0,r.wn)(s.lastChild.lastChild,n)}return i}switchCompact(){let e=this.get(0),t=this.get(0).rows,i=t[t.length-1].cells,r=1==i.length?i[0].childNodes[0]:null;if(r){r=$(r);let t=r.css("background-image").indexOf("up")<0;r.css("background-image",`url(../pics/arrow_white_${t?"up":"down"}.png)`),n.updateObjectDisplay(e,this.prop("meta"),this.prop("entity"),this.prop("options"))}}}}}let a=document.createElement("canvas")},892:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$W:()=>parseObject,CA:()=>startDragging,FL:()=>compileEntity,Lg:()=>renderObject,U:()=>showPopup,V9:()=>parseNative,_H:()=>jelemPopup,fM:()=>renderField,iK:()=>deduceMeta,sN:()=>MenuItem,uc:()=>renderNative,v5:()=>setDragPointer,vD:()=>getObjectLabel,wn:()=>parseField});var _entityListControl_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(16),_entityControl_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(397),_field_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(943),_objectTable_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(493),_model_entity_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(262),_model_entityList_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(183),_model_type_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(269),_model_mbase_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(574);function renderObject(e,t,i){return createJelem(_objectTable_js__WEBPACK_IMPORTED_MODULE_3__.X,e,t,i)}function isEmpty(e){for(let t in e)return!1;return!0}function evalLabel(typeId,context,expr){let codes=[];for(let e in context)codes.push(`var ${e} = context['${e}'];`);return codes.push(expr),eval(codes.join("\n"))}function getObjectLabel(e,t){if(!t)return"";let i=e.fields.find((e=>e.asLabel));var r;if(i)r=t[i.key];else if(e.labelExpr)try{r=evalLabel(e.typeId,t,e.labelExpr)}catch(e){console.log(e)}else r=t[e.fields[0].key];return(0,_model_mbase_js__WEBPACK_IMPORTED_MODULE_7__.kK)(r)?"":r.toString().trim()}function getFieldLabel(e,t){let i=getFieldHandlerOfMeta(t);return i&&i.getLabel&&i.getLabel(t,e)}function renderField(e,t,i){if(!t&&(e instanceof _model_entity_js__WEBPACK_IMPORTED_MODULE_4__.J||e instanceof _model_entityList_js__WEBPACK_IMPORTED_MODULE_5__.X)&&(t=e.getMeta()),t.array)return createJelem(_entityListControl_js__WEBPACK_IMPORTED_MODULE_0__.B,e,t,i);if(t.types){let r=e._type,s=t.types.find((e=>e.typeId==r));return createJelem(_entityControl_js__WEBPACK_IMPORTED_MODULE_1__.G,e,s,i)}return(0,_model_type_js__WEBPACK_IMPORTED_MODULE_6__.Kn)(t.type)?createJelem(_entityControl_js__WEBPACK_IMPORTED_MODULE_1__.G,e,t,i):renderNative(t,e,i)}function parseField(e,t){return t.array?getJelem(e,_entityListControl_js__WEBPACK_IMPORTED_MODULE_0__.B).wrap().parse():t.types||(0,_model_type_js__WEBPACK_IMPORTED_MODULE_6__.Kn)(t.type)?getJelem(e,_entityControl_js__WEBPACK_IMPORTED_MODULE_1__.G).wrap().parse():parseNative(t,e)}function compileEntity(e,t){if(e instanceof _model_entity_js__WEBPACK_IMPORTED_MODULE_4__.J){let t={};t._id=e._id,t._type=e._type;for(let i of e.getMeta().fields)t[i.key]=compileEntity(e[i.key],i);return t}if(e instanceof _model_entityList_js__WEBPACK_IMPORTED_MODULE_5__.X){let t=[];for(let i of e)t.push(compileEntity(i,e.getEntityMeta()));return t}{let i=getFieldHandlerOfMeta(t);return i.compile?i.compile(e):e}}function renderNative(e,t,i){let r=getFieldHandlerOfMeta(e);return i&&i.write?r.render(e,t,i):r.present(e,t,i)}function parseNative(e,t){return getFieldHandlerOfMeta(e).parse(t,e)}function parseObject(e,t){return getJelem(e,_objectTable_js__WEBPACK_IMPORTED_MODULE_3__.X).wrap().parse()}function deduceMeta(e){if(_.isArray(e))return{...deduceMeta(e[0]),array:!0};if(_.isObject(e))return{type:"object",fields:_.map(e,((e,t)=>({...deduceMeta(e),key:t})))};if(_.isBoolean(e))return{type:"boolean"};if(_.isString(e))return{type:"string"};if(_.isNumber(e))return{type:"number"};throw new Error("Invalid Type")}const popupClass=createClass({":focus":"outline:none"," .popupmenu":"padding:4px 6px 4px 6px; cursor:hand"});let popup;function hidePopup(){popup&&(popup.remove(),popup=null)}function sPopup(e,t,i,r,s){hidePopup();let n,a=0,l=0;if(s)for(let e=s.get(0);null!=e&&e!=document.body;e=e.parentNode)if("DIALOG"==e.tagName){let t=e.getBoundingClientRect();a-=t.x,l-=t.y,n=e;break}if(popup=$("<div/>",{class:popupClass}).append(e).attr("tabindex",-1).attr("outline",0).attr("hidefocus",!0),popup.css("position","absolute").css("width",t).css("height",i).css("background-color","white").css("border","1px solid #aaaaaa").css("box-shadow","2px 2px 5px 2px rgba(9,30,66,0.12)").on("blur",(e=>{popup.remove()})).on("mousedown",(e=>{popup.remove()})).appendTo($(n||document.body)),!i||!t){let e=popup.get(0).getBoundingClientRect();i||(i=e.height),t||(t=e.width)<r.w&&(t=r.w,popup.css("width",t))}let o=r.x+r.w-t,p=r.y+r.h;p+i>document.body.clientHeight&&(p=r.y-i),o<0&&(o=r.x),popup.css("left",o+document.body.scrollLeft+a),popup.css("top",p+document.body.scrollTop+l),popup.focus()}function showPopup(e,t,i,r,s,n){sPopup(e,t,i,{x:r+t,y:s,w:0,h:0},n)}function jelemPopup(e,t,i){let r=$(t).get(0).getBoundingClientRect();sPopup(e,r.w,null,{x:r.x,y:r.y,w:r.width,h:r.height},t)}class MenuItem{create(e,t,i){return $("<div/>").text(t).attr("class","popupmenu").mousedown(i)}css(){return{":hover":"background-color:#4288FF; color:white"}}}var dragPointerId;function setDragPointer(e){dragPointerId=e}function startDragging(e,t,i){let r=e.parent().get(0);t.preventDefault();let s=e=>{i.handleEvent(e)},n=e=>{r.removeEventListener("pointermove",s),r.removeEventListener("pointerup",n),r.releasePointerCapture(dragPointerId),i.handleEnd&&i.handleEnd(e)};r.addEventListener("pointermove",s),r.addEventListener("pointerup",n),r.setPointerCapture(dragPointerId)}function getFieldHandlerOfMeta(e){return e.typeId&&(0,_field_js__WEBPACK_IMPORTED_MODULE_2__.g)(e.typeId)||(0,_field_js__WEBPACK_IMPORTED_MODULE_2__.g)(e.type)}},752:(e,t,i)=>{i.d(t,{G:()=>s,z:()=>n});var r=i(574);function s(e){for(;e&&e!=document.body&&e.scrollHeight<=e.clientHeight;)e=e.parentNode;return e}function n(e,t,i){return e.html(""),i&&e.append($("<img/>",{src:i,style:"height:16px; margin-right:5px; vertical-align: middle;"})),!(0,r.kK)(t)&&""!==t||i?e.append(t):e.html("&nbsp;")}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](i,i.exports,__webpack_require__),i.exports}__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{__webpack_require__.d(__webpack_exports__,{TK:()=>a,ux:()=>A,sP:()=>y,sN:()=>t.sN,cU:()=>m,Ce:()=>s.Ce,FL:()=>t.FL,iK:()=>t.iK,Ks:()=>s.Ks,VN:()=>s.VN,fw:()=>b,Hv:()=>s.Hv,vD:()=>t.vD,Gh:()=>_.G,kK:()=>n.kK,u7:()=>n.u7,tP:()=>n.tP,Fi:()=>o.F,wn:()=>t.wn,$W:()=>t.$W,eJ:()=>s.eJ,H6:()=>e.H,Fn:()=>l.Fn,L4:()=>c,fM:()=>t.fM,Lg:()=>t.Lg,v5:()=>t.v5,U:()=>t.U,CA:()=>t.CA,jl:()=>n.jl});var e=__webpack_require__(943),t=__webpack_require__(892);(0,e.H)("object",new class{render(e,i,r){return(0,t.Lg)(e,i,r)}parse(e,i){return(0,t.$W)(e,i)}present(e,i,r){return(0,t.Lg)(e,i,r)}getLabel(e,i){return(0,t.vD)(e,i)}});class i{create(e,t){return $("<div/>").attr("tabindex",-1).css("width","300px").css("height","300px").css("background-image",e&&`url("${e}")`)}css(){return{"":"background-size: contain; background-repeat: no-repeat; background-position: center;border: 1px solid gray; border-radius: 3px"}}wrap(){return class{parse(){let e=this.css("background-image").match(/url\((.*?)\)/);return e?e[1].replace(/(?:^"|"$)/g,""):""}}}}async function r(e,t){var i=new FormData;i.append("file",function(e){for(var t=atob(e.split(",")[1]),i=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),s=new Uint8Array(r),n=0;n<t.length;n++)s[n]=t.charCodeAt(n);return new Blob([r],{type:i})}(event.target.result),"a.png"),i.append("seq",123);let r=await fetch("/api/projects/64256f7ce039047b1e7ce4c0/images",{method:"POST",body:i});return await r.json()}bindClassHandler(i,"drop",(async(e,t,i)=>{i.preventDefault();let s=i.dataTransfer.files;if(1==s.length&&s[0].type.match(/^image\//)){let e=await(n=s[0],new Promise(((e,t)=>{let i=new FileReader;i.onload=async function(t){e(t.target.result)},i.readAsDataURL(n)})));i.target.style.backgroundImage="url("+e+")";let t=await r(s[0].name);i.target.style.backgroundImage="url("+t.path+")"}var n})),(0,e.H)("image",new class{render(e,t){return createJelem(i,t,e)}parse(e){return"IMG"==e.tagName?e.src:getJelem(e,i).wrap().parse()}present(e,t){return $("<img/>",{src:t,style:'width:300px; background-repeat: no-repeat; background-position: center; background-image: url("../pics/loading-gif.gif")'})}});var s=__webpack_require__(941),n=__webpack_require__(574);class a{async patchAllEntities(e,t){let i=[];for(let r of t){let t={...r};i.push(t);let s=r.jpath;if(s.startsWith("#")){let i=s.indexOf(".");if(i<0){let i=s.substring(1);if(r.new)if(r.old){if(!await this.getEntity(e,i))continue;t.new=await this.updateEntity(e,i,r.new)}else t.new=await this.addEntity(e,r.new);else r.old&&await this.deleteEntity(e,i)}else{if((0,n.kK)(r.old)&&(0,n.kK)(r.new))continue;let t=s.substring(1,i),a=await this.getEntity(e,t);if(!a)continue;(0,n.B6)(a,s.substring(i+1),r.old,r.new),await this.updateEntity(e,t,a)}}else if(s){if((0,n.kK)(r.old)&&(0,n.kK)(r.new))continue;let t=await this.getAllEntities(e);(0,n.B6)(t,s,r.old,r.new),await this.setAllEntities(e,t)}else await this.setAllEntities(e,r.new)}return JSON.parse(JSON.stringify(i))}}(0,s.eJ)("localstorage://entities/:model",new class extends a{async getAllEntities(e){let t=window.localStorage.getItem(e.model)||"",i=[];if(t){let r=t.split(",");for(let t of r)i.push(await this.getEntity(e,t))}return i}async addEntity(e,t){let i=window.localStorage.getItem(e.model)||"",r=t._id||crypto.randomUUID();i+=(i?",":"")+r.toString();let s=JSON.stringify({_id:r,...t});return window.localStorage.setItem(`${e.model}.${r}`,s),window.localStorage.setItem(e.model,i),JSON.parse(s)}async getEntity(e,t){let i=window.localStorage.getItem(`${e.model}.${t}`);return i?JSON.parse(i):void 0}async updateEntity(e,t,i){let r=window.localStorage.getItem(e.model)||"";if(r&&r.split(",").find((e=>e==t))){let r=JSON.stringify({_id:t,...i});return window.localStorage.setItem(`${e.model}.${t}`,r),JSON.parse(r)}}async deleteEntity(e,t){let i=window.localStorage.getItem(e.model)||"";if(i){let r=i.split(",");r.find((e=>e==t))&&(window.localStorage.removeItem(`${e.model}.${t}`),window.localStorage.setItem(e.model,r.filter((e=>e!=t)).join(",")))}}});var l=__webpack_require__(269),o=__webpack_require__(173),p=__webpack_require__(183),d=__webpack_require__(250),_=__webpack_require__(752);function c(e,i){let r=$("<div/>").click(h);return e instanceof p.X&&(r.append(e.map(u)),e.getListener().add("contents",(i=>function(e,i,r){if("change"==r.type)(0,d.o)(i,[...e,e],(e=>e.prop("entity")),u);else if("childEvent"==r.type&&"fieldChange"==r.event.type&&r.jpath.indexOf(".")<0){let e=i.children().toArray(),s=r.jpath.substring(1),n=e.find((e=>e.entity.getId()==s));if(n){let e=$(n),i=(0,t.vD)(n.entity.getMeta(),n.entity);i!=e.text()&&(0,_.z)(e,i)}}}(e,r,i))),r.append(g(e,"(End)").css("font-style","italic"))),r}function h(){try{event.target.entity.getListener().publish({type:"focus"})}catch(e){}}function u(e){return g(e,(0,t.vD)(e.getMeta(),e))}function g(e,t){return(0,_.z)($("<div/>",{style:"padding: 2px 2px 2px 18px; cursor: hand; white-space: nowrap"}),t).prop("entity",e)}class f{constructor(e,t,i){this.sliderbar=e,this.startWidth=e.getWidth(),this.adjust=-t.pageX,this.reverse=i}handleEvent(e){this.sliderbar.setWidth(this.startWidth+(this.reverse?-e.pageX-this.adjust:e.pageX+this.adjust))}handleEnd(e){this.sliderbar.save()}}class y{create(e){return $("<div/>").prop("options",e).append($("<div/>",{style:"flex: 0 0 48px; background-color:#999999; display: flex; align-items: center; flex-direction: column;"})).append($("<div/>",{style:"flex: 1 1; overflow: auto"})).append($("<div/>",{style:"flex: 0 0 12px; height: 100%; cursor: ew-resize; width:12px;"}).attr("draggable",!0).append($("<div/>",{class:"slide"}).css("left","right"==e?.float?"10px":"-3px")).on("pointerdown",(e=>(0,t.v5)(e.pointerId))).on("dragstart",(i=>{let r=getJelem(i.target,y).wrap();(0,t.CA)(r,i,new f(r,i,"right"==e?.float))})))}css(){return{"":"display: flex",".icon":"padding:3px; margin-top:10px; border-radius: 5px; cursor:hand",".slide":"width:3px; height: 100%; position: relative; background: linear-gradient(to left, rgba(0, 0, 0, 0.2) 0px, rgba(0, 0, 0, 0.2) 1px, rgba(0, 0, 0, 0.1) 1px, rgba(0, 0, 0, 0) 100%)"}}wrap(){return class{setWidth(e){this.isHidden(e)?this.hide():(this.restore(),this.css("flex",`0 0 ${e}px`))}hide(){let e=this.children(":first-child"),t=e.next();"none"!=t.css("display")&&(this.prop("oldSelected",this.getSelectedIndex()),this.css("flex","0 0 60px"),t.css("display","none"),e.children().css("background-color",""),t.children().css("display","none"))}restore(){let e=this.children(":first-child"),t=e.next();"none"==t.css("display")&&(t.css("display","block"),$(e.children[this.prop("oldSelected")]).css("background-color","white"),this.css("flex",`0 0 ${Math.abs(this.loadWidth(this.prop("options")?.key))}px`),this.save(),this.select(this.prop("oldSelected")))}getSelectedIndex(){let e=this.children(":first-child").next().children();for(let t=0;t<e.length;t++)if("none"!=$(e[t]).css("display"))return t;return-1}getWidth(){let e=(this.css("flex")||"").match(/([\d\.]+)px$/);return e?parseFloat(e[1]):200}save(){let e=this.prop("options")?.key;if(e){let t=this.getWidth();window.localStorage.setItem(e,this.isHidden(t)?-Math.abs(this.loadWidth(e)):t)}}isHidden(e){return e<80}loadWidth(e){let t=parseFloat(window.localStorage.getItem(e));return isNaN(t)?260:t}load(){let e=this.loadWidth(this.prop("options")?.key);return e<0?this.hide():this.setWidth(e),this}select(e){let t=this.children(":first-child"),i=t.children(),r=t.next().children(),s=$(i[e]),n=$(r[e]);this.getSelectedIndex()==e?(this.hide(),this.save()):(this.restore(),i.css("background-color",""),s.css("background-color","white"),r.css("display","none"),n.css("display","block"))}add(e,t,i){let r=this.children(":first-child");return r.append($("<img/>",{src:t,title:e,class:"icon"}).click((e=>{let t=0;for(let i=e.target;null!=i;i=i.previousSibling)console.log(i.tagName),t++;getJelem(e.target,y).wrap().select(t-1)}))),r.next().append($("<div/>").append(i()).css("display","none")),1==r.children().length&&this.select(0),this}}}}var w=__webpack_require__(397);function b(e,t){let i={};for(let r=getJelem(e,w.G);r;r=getJelem(r.parent(),w.G)){let e=r.prop("entity");for(let r in t)if(!i.hasOwnProperty(r)){let t=e[r];(0,n.kK)(t)||(i[r]=t)}}return i}class x{constructor(e,t,i){this.sliderbar=e,this.startWidth=e.getWidth(),this.adjust=-t.pageX,this.reverse=i}handleEvent(e){this.sliderbar.setWidth(this.startWidth+(this.reverse?-e.pageX-this.adjust:e.pageX+this.adjust))}handleEnd(e){this.sliderbar.save()}}class m{create(e){return $("<div/>").attr("draggable",!0).prop("options",e).css("margin-left","right"==e?.float?"":"auto").append($("<div/>").css("left","right"==e?.float?"10px":"-3px").append($("<div/>",{class:"switch"}).css("transform","right"==e?.float?"rotate(180deg)":"none").click((e=>getJelem(e.target,m).wrap().switch())))).on("pointerdown",(e=>(0,t.v5)(e.pointerId))).on("dragstart",(i=>{let r=getJelem(i.target,m).wrap();(0,t.CA)(r,i,new x(r,i,"right"==e?.float))}))}css(){return{"":"flex: 0 0 12px; height: 100%; cursor: ew-resize; width:12px",">div":"width:3px; height: 100%; position: relative; background: linear-gradient(to left, rgba(0, 0, 0, 0.2) 0px, rgba(0, 0, 0, 0.2) 1px, rgba(0, 0, 0, 0.1) 1px, rgba(0, 0, 0, 0) 100%)",".switch":"cursor:hand; box-shadow: 0px 2px 5px 0px rgba(9,30,66,0.12); position:relative; left: -10px; top: 30px; background: white url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAOhJREFUOE+9kzFqAkEUhudftvMwFskBUovFm0fwBDF26VIK4imMFh5g2XmzhYRAIBcwjcFOvIPa7wsLI4iIOyI63cD/ffyPNwNz5cGVvLmPgIgGABoi8n7cuLYBM3+o6msFJknSzPN8cSg5K2DmvqoOAzATkXZ0A2tt1xgzDsAfAHLOraMERPQE4CeENwCenXPfpzZ2cgQiegAwrwBV3apqpyiKr2hBFWTmnqqOArRM05SyLFtFjbAPEdEQQD/cP0WkdZGgCltrJ8aYlzDOo/f+N3qN+yAzT8uy3Hnv3y5uUPdXal/izQX/3wFKEahfekEAAAAASUVORK5CYII=) repeat center; width: 22px; height:22px; border-radius: 50%; border: 1px solid #CCCCCC;"}}wrap(){return class{switch(){this.isHidden(this.getWidth())?this.restore():this.hide(),this.save()}setWidth(e){this.isHidden(e)?this.hide():(this.restore(),this.parent().css("flex",`0 0 ${e}px`))}restore(){this.isHidden(this.getWidth())&&(this.siblings().css("display",""),this.getChild().css("transform","right"==this.prop("options")?.float?"rotate(180deg)":"none"),this.parent().css("flex",`0 0 ${Math.abs(this.loadWidth(this.prop("options")?.key))}px`),this.save())}isHidden(e){return e<40}getChild(){return this.children(":first-child").children(":first-child")}hide(){this.isHidden(this.getWidth())||(this.parent().css("flex","0 0 26px"),this.siblings().css("display","none"),this.getChild().css("transform","right"==this.prop("options")?.float?"none":"rotate(180deg)"))}getWidth(){return parseFloat(this.parent().css("flex").match(/([\d\.]+)px$/)[1])}save(){let e=this.prop("options")?.key;if(e){let t=this.getWidth();window.localStorage.setItem(e,t<40?-Math.abs(this.loadWidth(e)):t)}}loadWidth(e){let t=parseFloat(window.localStorage.getItem(e));return isNaN(t)?200:t}load(){let e=this.loadWidth(this.prop("options")?.key);e<0?this.hide():this.setWidth(e)}}}}var A=__webpack_require__(488)})();var __webpack_exports__BasicStorage=__webpack_exports__.TK,__webpack_exports__CSS=__webpack_exports__.ux,__webpack_exports__ContentsPanel=__webpack_exports__.sP,__webpack_exports__MenuItem=__webpack_exports__.sN,__webpack_exports__SlideBar=__webpack_exports__.cU,__webpack_exports__addEntity=__webpack_exports__.Ce,__webpack_exports__compileEntity=__webpack_exports__.FL,__webpack_exports__deduceMeta=__webpack_exports__.iK,__webpack_exports__deleteEntity=__webpack_exports__.Ks,__webpack_exports__getAllEntities=__webpack_exports__.VN,__webpack_exports__getContext=__webpack_exports__.fw,__webpack_exports__getEntity=__webpack_exports__.Hv,__webpack_exports__getObjectLabel=__webpack_exports__.vD,__webpack_exports__getScrollableElem=__webpack_exports__.Gh,__webpack_exports__isNil=__webpack_exports__.kK,__webpack_exports__loadModel=__webpack_exports__.u7,__webpack_exports__makeModel=__webpack_exports__.tP,__webpack_exports__normalizeData=__webpack_exports__.Fi,__webpack_exports__parseField=__webpack_exports__.wn,__webpack_exports__parseObject=__webpack_exports__.$W,__webpack_exports__registerEntityStorage=__webpack_exports__.eJ,__webpack_exports__registerFieldHandler=__webpack_exports__.H6,__webpack_exports__registerType=__webpack_exports__.Fn,__webpack_exports__renderContents=__webpack_exports__.L4,__webpack_exports__renderField=__webpack_exports__.fM,__webpack_exports__renderObject=__webpack_exports__.Lg,__webpack_exports__setDragPointer=__webpack_exports__.v5,__webpack_exports__showPopup=__webpack_exports__.U,__webpack_exports__startDragging=__webpack_exports__.CA,__webpack_exports__traverseModel=__webpack_exports__.jl;export{__webpack_exports__BasicStorage as BasicStorage,__webpack_exports__CSS as CSS,__webpack_exports__ContentsPanel as ContentsPanel,__webpack_exports__MenuItem as MenuItem,__webpack_exports__SlideBar as SlideBar,__webpack_exports__addEntity as addEntity,__webpack_exports__compileEntity as compileEntity,__webpack_exports__deduceMeta as deduceMeta,__webpack_exports__deleteEntity as deleteEntity,__webpack_exports__getAllEntities as getAllEntities,__webpack_exports__getContext as getContext,__webpack_exports__getEntity as getEntity,__webpack_exports__getObjectLabel as getObjectLabel,__webpack_exports__getScrollableElem as getScrollableElem,__webpack_exports__isNil as isNil,__webpack_exports__loadModel as loadModel,__webpack_exports__makeModel as makeModel,__webpack_exports__normalizeData as normalizeData,__webpack_exports__parseField as parseField,__webpack_exports__parseObject as parseObject,__webpack_exports__registerEntityStorage as registerEntityStorage,__webpack_exports__registerFieldHandler as registerFieldHandler,__webpack_exports__registerType as registerType,__webpack_exports__renderContents as renderContents,__webpack_exports__renderField as renderField,__webpack_exports__renderObject as renderObject,__webpack_exports__setDragPointer as setDragPointer,__webpack_exports__showPopup as showPopup,__webpack_exports__startDragging as startDragging,__webpack_exports__traverseModel as traverseModel};